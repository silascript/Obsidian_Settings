
# 这是一个jq示例代码库

# obsidian 官方社区插件列表地址
# https://raw.githubusercontent.com/obsidianmd/obsidian-releases/refs/heads/master/community-plugins.json
# 根据 插件id查询插件仓库地址
# curl https://raw.githubusercontent.com/obsidianmd/obsidian-releases/refs/heads/master/community-plugins.json | jq -r '.[]| select(.id=="better-word-count") | .repo'

# 从json文件获取文件下载地址，并将其存放至数据数组中
# main.js manifest.json styles.css 下载地址
local dl_file_addr=$(curl $json_path | jq -r '.assets[] | .browser_download_url | select ( contains("main.js") or contains("manifest.json") or contains("styles.css") ) ')

# 根据 id 取出相应的插件对象
# cat community-plugins.json | jq '.[]| select(.id=="better-word-count")'
# 进一步取出repo属性值，这个就是插件仓库地址：账号/仓库名
# cat community-plugins.json | jq -r '.[]| select(.id=="better-word-count") | .repo'

# 根据vault的目录路径获取vault的ID
cat .config/obsidian/obsidian.json | jq -r '.vaults | map_values(select(.path=="/home/silascript/MyNotes/WritingExericse")) | keys'


# 测试 https://api.github.com/repos/lukeleppan/better-word-count/releases
# release json的地址最后不能有 /
# 
# 最新版 https://api.github.com/repos/lukeleppan/better-word-count/releases/latest
# tag_name 记录的是版本号
# 所以可以查询指定版本的release json文件
# https://api.github.com/repos/lukeleppan/better-word-count/releases/tags/tag_name


# 获取 releases 下 几个文件：
# main.js
# manifest.json
# styles.css
# 这是obsidian插件构成的文件，其中前两个必须有，styles.css可选
# curl releases的json文件地址 | jq -r '.assets[] | .browser_download_url | select ( contains("main.js") or contains("manifest.json") or contains("styles.css") ) '
# curl https://api.github.com/repos/lukeleppan/better-word-count/releases/tags/0.10.0 | jq -r '.assets[] | .browser_download_url | select ( contains("main.js") or contains("manifest.json") or contains("styles.css") ) '
# 结果会如下：
# https://github.com/lukeleppan/better-word-count/releases/download/0.10.0/main.js
# https://github.com/lukeleppan/better-word-count/releases/download/0.10.0/manifest.json
# https://github.com/lukeleppan/better-word-count/releases/download/0.10.0/styles.css


# 生成 .obsidian目录下的community-plugin.json文件
# 这个文件是记录哪些插件已启用
# 默认如果只是把插件文件复制到plugins目录下，只是算安装成功，但未启动
# 注意最后不能有逗号，不然jq什么出错
#echo '["power-mode","editing-toolbar","mermaid-tools","obsidian-importer","obsidian-better-codeblock","dust-calendar"]' | jq
echo '["obsidian-style-settings","better-word-count","obsidian-html-tags-autocomplete","colored-tags"]'| jq > ob_plugins.json
